---
import "@styles/style.css";
import { Image } from "astro:assets";
import CloseIcon from "../../assets/close.svg";

type Props = {
  title: string;
};

const { title } = Astro.props;
---

<div class="modal-overlay" id="modalOverlay"></div>

<div class="modal" id="modal">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-header-title">
        <h2>{title}</h2>
      </div>
      <div class="modal-header-close">
        <button class="modal-header-close" id="closeModal">
          <Image src={CloseIcon} alt="close" />
        </button>
      </div>
    </div>
    <slot />
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("modal") as HTMLDivElement;
    const modalOverlay = document.getElementById(
      "modalOverlay"
    ) as HTMLDivElement;
    const closeModalButton = document.getElementById(
      "closeModal"
    ) as HTMLButtonElement;

    closeModalButton.addEventListener("click", () => {
      formReset();
      closeModal();
    });

    window.addEventListener("click", (event) => {
      if (event.target === modalOverlay) {
        formReset();
        closeModal();
      }
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        formReset();
        closeModal();
      }
    });

    const closeModal = () => {
      modal.style.display = "none";
      modalOverlay.style.display = "none";
    };

    const formReset = () => {
      const form = document.getElementById("add-todo-form") as HTMLFormElement;
      if (form) {
        form.reset();
      }
    };
  });
</script>
